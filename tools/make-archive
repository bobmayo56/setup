#!/usr/bin/env bash

# make-archive

# part of a pair: make-archive and extract-archive 

if [ $# -ne 2 ]; then
    echo "Usage: make-archive <folder> <archive-name>"
    echo "Example: make-archive documents docs-2026"
    exit 1
fi

FOLDER=$1
ARCHIVE=$2

if [ ! -d "$FOLDER" ]; then
    echo "Error: '$FOLDER' is not a directory"
    exit 1
fi

SEVENZIP_PROGRAM="${SEVENZIP_PROGRAM:-7zz}"

read -r -s -p "Password: " PASSWORD
echo
read -r -s -p "Confirm password: " PASSWORD2
echo

if [ "$PASSWORD" != "$PASSWORD2" ]; then
    echo "Error: passwords do not match"
    exit 1
fi

# -mhe=on encrypts the archive headers as well as the contents
"$SEVENZIP_PROGRAM" a -mhe=on -p"$PASSWORD" "${ARCHIVE}.7z" "$FOLDER" && echo "Created: ${ARCHIVE}.7z"

